"use strict";function reader(s,n,t,c){return 1==n?(console.log(222222),readerHtml()):new Promise(function(o){var n=localStorage.getItem("userID"),e=localStorage.getItem("userName");$.ajax({url:"../api/car.php",type:"get",data:{way:s,userID:n||"",userName:e||"",goodsID:t||"",buy_num:c||""},dataType:"json",success:function(n){console.log(n),localStorage.setItem("goods",JSON.stringify(n)),readerHtml(),o()},error:function(n){console.log(n)}})})}function readerHtml(n){var o;o=localStorage.getItem("goods")?n||JSON.parse(localStorage.getItem("goods")):[];var e="";if(0==o.code)return e=o.msg,void $("#warp-contain").html(e);Allselect(o);var s={},t=o.reduce(function(n,o){return s[o.sort2]||(s[o.sort2]=n.push(o)),n},[]).length,c=o.reduce(function(n,o){return s[o.sort1]||(s[o.sort1]=n.push(o)),n},[]).length;console.log(c);var i=o.reduce(function(n,o){return n+ +o.count},0),n=o.filter(function(n){return 1==n.is_select}),c=n.reduce(function(n,o){return n+ +o.count},0),n=n.reduce(function(n,o){return n+o.count*o.goods_price},0);o.forEach(function(n){e+='\n            <div id="goodsContain">\n\n                <div class="s_goods_item" g-index="'+n.goods_id+'">\n                    <div class="goods-item _1">\n                        <input type="checkbox" class="select" '+(1==n.is_select?"checked":"")+'>\n                    </div>\n                    <div class="goods-item _2">\n                        <img src="'+n.goods_pic+'">\n                        <p class="good-name">'+n.goods_name+'</p>\n                    </div>\n                    <div class="goods-item _3">\n                        <span class="goods-sort _gray">'+n.sort1+"—"+n.sort2+'</span>\n                    </div>\n\n                    <div class="goods-item _4">\n                        <span>￥</span>\n                        <span class="g_price _red">'+n.goods_price+'</span>\n                    </div>\n\n                    <div class="goods-item _5">\n                        <a class="reduce-s-num no-select">-</a>\n                        <input type="text" class="buy-s-num" value="'+n.count+'" total="'+n.goods_number+'">\n                        <a class="add-s-num no-select">+</a>\n                    </div>\n                    <div class="goods-item _6">\n                        <span>￥</span>\n                        <span class="gt-price _red">'+(n.count*n.goods_price).toFixed(2)+'</span>\n                    </div>\n                    <div class="goods-item _7">\n                        <button class="goods-del">删除</button>\n                    </div>\n                </div>\n\n\n\n            </div>\n\n            '}),e+='\n        <div id="checkout">\n            <div class="check-item ">商品种类:&nbsp;<span class="g-type _red">'+t+'</span></div>\n            <div class="check-item ">商品总数量:&nbsp;<span class="total-num _red">'+i+'</span></div>\n            <div class="check-item ">已选商品:&nbsp;<span class="g-sel-num _red">'+c+'</span>&nbsp;件</div>\n            <div class="check-item ">合计:&nbsp;<span class="total-meney _red">'+n.toFixed(2)+'</span>&nbsp;元</div>\n            <div class="check-item "><button id="checkout_btn">结算</button></div>\n        </div>\n        ',$("#warp-contain").html(e)}function Allselect(n){n.every(function(n){return 1==n.is_select})?($("#check-goods-all").attr("checked","true"),console.log("check")):$("#check-goods-all").removeAttr("checked")}function fun(){function e(n){var o=n.attr("total"),e=+n.val();/^\d+$/.test(e)||(alert("请输入大于1的数字"),reader("fun2",1),fun(),console.log(333333)),console.log("counting"),o<e&&alert("库存不足!"),e=o<=(e=e<=0?1:e)?o:e,n.val(e);n=n.parent().parent().attr("g-index");console.log(n,e),p("fun3",n,e,!0).then(function(n){fun(),console.log(n)})}console.log(55555),$("#check-goods-all").click(function(){console.log($(this).attr("id"));var o=$(this)[0].checked,n=JSON.parse(localStorage.getItem("goods"));n.forEach(function(n){n.is_select=o?1:0}),localStorage.setItem("goods",JSON.stringify(n)),readerHtml(),console.log(n),console.log(localStorage.getItem("goods"))}),$("#warp-contain .select").click(function(){console.log($(this));var o=$(this)[0].checked,e=$(this).parent().parent().attr("g-index"),s=JSON.parse(localStorage.getItem("goods")),t=void 0;s.forEach(function(n){n.goods_id==e&&(o=n.is_select=o?1:0,t=n.is_select)}),p("fun5",e,0,!1,t).then(function(n){localStorage.setItem("goods",JSON.stringify(s)),readerHtml(),fun()})}),$("#warp-contain .reduce-s-num").click(function(){console.log("reduce");var n=$(this).next().val()-1,o=$(this).next();$(this).next().val(n),e(o)}),$("#warp-contain .add-s-num").click(function(){console.log("add");var n=+$(this).prev().val()+1,o=$(this).prev();$(this).prev().val(n),e(o)}),$("#warp-contain .goods-del").click(function(){console.log("del");var e=$(this).parent().parent().attr("g-index");console.log(e),1==confirm("你确定要删除吗？")&&p("fun4",e,0,!1,0).then(function(n){var o=(o=JSON.parse(localStorage.getItem("goods"))).filter(function(n){return n.goods_id!=e});localStorage.setItem("goods",JSON.stringify(o)),readerHtml(),console.log(o),fun()})}),$("#warp-contain #checkout_btn").click(function(){console.log("check");var o=[];JSON.parse(localStorage.getItem("goods")).forEach(function(n){1==n.is_select&&o.push(n.goods_id)});var n=o.join(",");if(""==n)return alert("还没选择商品");n="("+o.join(",")+")",console.log(n),confirm("再次确认")&&p2("fun8",n).then(function(n){console.log(n),localStorage.setItem("goods",JSON.stringify(n)),readerHtml(),fun(),console.log(JSON.stringify(n))})}),$("#warp-contain .buy-s-num").change(function(){e($(this))})}(void 0).reader("fun2").then(function(){fun()});var p=function(s,t,c,i,a){return new Promise(function(o){var n=localStorage.getItem("userID"),e=localStorage.getItem("userName");$.ajax({url:"../api/car.php",type:"get",data:{way:s,userID:n||"",userName:e||"",goodsID:t||"",buy_num:c||"",del:a||"0"},dataType:"json",success:function(n){console.log(n),i&&(localStorage.setItem("goods",JSON.stringify(n)),readerHtml()),o()},error:function(n){console.log(n)}})})},p2=function(n,o){return userID=localStorage.getItem("userID"),console.log(n,o,userID),new Promise(function(e){$.ajax({url:"../api/car.php",type:"get",data:{way:n,userID:userID,goodsID:o||0},dataType:"json",success:function(n){var o="";if(console.log(n),console.log(n.length),1<=n.length)return n.forEach(function(n){o+='\n                <div id="goodsContain">\n    \n                    <div class="s_goods_item" g-index="'+n.goods_id+'">\n                        <div class="goods-item _1">\n                            订单完成\n                        </div>\n                        <div class="goods-item _2">\n                            <img src="'+n.goods_pic+'">\n                            <p class="good-name">'+n.goods_name+'</p>\n                        </div>\n                        <div class="goods-item _3">\n                            <span class="goods-sort _gray">'+n.sort1+"—"+n.sort2+'</span>\n                        </div>\n    \n                        <div class="goods-item _4">\n                            <span>￥</span>\n                            <span class="g_price _red">'+n.goods_price+'</span>\n                        </div>\n    \n                        <div class="goods-item _5" style="font-size:16px; color:red">'+n.count+'</div>\n                        <div class="goods-item _6">\n                            <span>￥</span>\n                            <span class="gt-price _red">'+(n.count*n.goods_price).toFixed(2)+'</span>\n                        </div>\n                        <div class="goods-item _7">\n                            <button class="goods-del" g-index="'+n.goods_id+'">删除</button>\n                        </div>\n                    </div>\n    \n    \n    \n                </div>\n    \n                '}),o+='\n                    <div id="checkout">\n                        <div class="check-item "></div>\n                        <div class="check-item "></div>\n                        <div class="check-item "></div>\n                        <div class="check-item "></div>\n                        <div class="check-item "><button id="checkout_btn" style="background:red">历史</button></div>\n                    </div>\n                    ',$("#warp-contain").html(o),e(n);$("#warp-contain").html("暂无相关信息"),e(n)}})})};$(".mine").click(function(){p2("fun6").then(function(n){console.log(n),fun(),$(".goods-del").click(function(){fun();var n=$(this).attr("g-index");p2("fun7",n).then(function(n){fun(),p2("fun6").then(function(){fun()})})})})});